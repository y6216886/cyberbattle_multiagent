FROM python:3.10-slim

# Keep image minimal and only install environment (no repo code copied)
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

# Install system deps commonly needed for Python packages (adjust if necessary)
RUN apt-get update \
    && apt-get install -y --no-install-recommends build-essential gcc libssl-dev libffi-dev \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /opt/env

# Copy only requirements that will be included in the build context by the helper script
COPY requirements.txt /opt/env/requirements.txt

# Install Python deps from requirements
RUN python -m pip install --upgrade pip setuptools wheel \
    && pip install -r requirements.txt

# Create a simple environment metadata file for inspection (python version and installed packages list)
RUN python - <<'PY'
import sys, pkg_resources, json
env = {
    'python_version': sys.version,
    'packages': sorted([f"{p.key}=={p.version}" for p in pkg_resources.working_set])
}
with open('/opt/env/env_info.json', 'w') as f:
    json.dump(env, f, indent=2)
PY

# Default command is shell so user can inspect container interactively if needed
CMD ["/bin/bash"]
